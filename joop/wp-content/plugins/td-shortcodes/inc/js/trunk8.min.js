(function(e){function s(t){this.$element=e(t);this.original_text=this.$element.html();this.settings=e.extend({},e.fn.trunk8.defaults)}function o(e){var t=document.createElement("DIV");t.innerHTML=e;return t.textContent||t.innerText}function u(e){if(o(e)===e){return e.split(/\s/g)}var t=[],n=/<([a-z]+)([^<]*)(?:>(.*?(?!<\1>)*)<\/\1>|\s+\/>)(['.?!,]*)|((?:[^<>\s])+['.?!,]*\w?|<br\s?\/?>)/ig,r=n.exec(e),i,s;while(r&&i!==n.lastIndex){i=n.lastIndex;if(r[5]){t.push(r[5])}else if(r[1]){t.push({tag:r[1],attribs:r[2],content:r[3],after:r[4]})}r=n.exec(e)}for(s=0;s<t.length;s++){if(typeof t[s]!=="string"&&t[s].content){t[s].content=u(t[s].content)}}return t}function a(t,n,r){t=t.replace(r,"");var i=function(n,s){var o="",u,a,f,l,c;for(c=0;c<n.length;c++){u=n[c];f=e.trim(t).split(" ").length;if(e.trim(t).length){if(typeof u==="string"){if(!/<br\s*\/?>/.test(u)){if(f===1&&e.trim(t).length<=u.length){u=t;if(s==="p"||s==="div"){u+=r}t=""}else{t=t.replace(u,"")}}o+=e.trim(u)+(c===n.length-1||f<=1?"":" ")}else{a=i(u.content,u.tag);if(u.after)t=t.replace(u.after,"");if(a){if(!u.after)u.after=" ";o+="<"+u.tag+u.attribs+">"+a+"</"+u.tag+">"+u.after}}}}return o},s=i(n);if(s.slice(s.length-r.length)===r){s+=r}return s}function f(){var t=this.data("trunk8"),r=t.settings,s=r.width,f=r.side,l=r.fill,c=r.parseHTML,h=n.getLineHeight(this)*r.lines,p=t.original_text,d=p.length,v="",m,g,y,b,w,E;this.html(p);w=this.text();if(c&&o(p)!==p){E=u(p);p=o(p);d=p.length}if(s===i.auto){if(this.height()<=h){return}m=0;g=d-1;while(m<=g){y=m+(g-m>>1);b=n.eatStr(p,f,d-y,l);if(c&&E){b=a(b,E,l)}this.html(b);if(this.height()>h){g=y-1}else{m=y+1;v=v.length>b.length?v:b}}this.html("");this.html(v);if(r.tooltip){this.attr("title",w)}}else if(!isNaN(s)){y=d-s;b=n.eatStr(p,f,y,l);this.html(b);if(r.tooltip){this.attr("title",p)}}else{e.error('Invalid width "'+s+'".')}}var t,n,r={center:"center",left:"left",right:"right"},i={auto:"auto"};s.prototype.updateSettings=function(t){this.settings=e.extend(this.settings,t)};t={init:function(t){return this.each(function(){var n=e(this),r=n.data("trunk8");if(!r){n.data("trunk8",r=new s(this))}r.updateSettings(t);f.call(n)})},update:function(t){return this.each(function(){var n=e(this);if(t){n.data("trunk8").original_text=t}f.call(n)})},revert:function(){return this.each(function(){var t=e(this).data("trunk8").original_text;e(this).html(t)})},getSettings:function(){return e(this.get(0)).data("trunk8").settings}};n={eatStr:function(t,i,s,o){var u=t.length,a=n.eatStr.generateKey.apply(null,arguments),f,l;if(n.eatStr.cache[a]){return n.eatStr.cache[a]}if(typeof t!=="string"||u===0){e.error('Invalid source string "'+t+'".')}if(s<0||s>u){e.error('Invalid bite size "'+s+'".')}else if(s===0){return t}if(typeof (o+"")!=="string"){e.error("Fill unable to be converted to a string.")}switch(i){case r.right:return n.eatStr.cache[a]=e.trim(t.substr(0,u-s))+o;case r.left:return n.eatStr.cache[a]=o+e.trim(t.substr(s));case r.center:f=u>>1;l=s>>1;return n.eatStr.cache[a]=e.trim(n.eatStr(t.substr(0,u-f),r.right,s-l,""))+o+e.trim(n.eatStr(t.substr(u-f),r.left,l,""));default:e.error('Invalid side "'+i+'".')}},getLineHeight:function(t){var n=e(t).css("float");if(n!=="none"){e(t).css("float","none")}var r=e(t).css("position");if(r==="absolute"){e(t).css("position","static")}var i=e(t).html(),s="line-height-test",o;e(t).html("i").wrap('<div id="'+s+'" />');o=e("#"+s).innerHeight();e(t).html(i).css({"float":n,position:r}).unwrap();return o}};n.eatStr.cache={};n.eatStr.generateKey=function(){return Array.prototype.join.call(arguments,"")};e.fn.trunk8=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist on jQuery.trunk8")}};e.fn.trunk8.defaults={fill:"&hellip;",lines:1,side:r.right,tooltip:true,width:i.auto,parseHTML:false}})(jQuery);